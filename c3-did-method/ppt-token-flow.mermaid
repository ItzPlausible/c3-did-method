%% C3 DID Method â€” PPT Token Flow Diagram
%% Version: 0.4 | Date: 2026-02-08
%% End-to-end PPT earning, vault accounting, transmutation, and VELOC flow

flowchart TB
    subgraph C3DEX["ğŸ›ï¸ C3DEX Marketplace"]
        IO[Impact Offer<br/>Vickrey Auction]
        IO --> |"Winner selected"| WV{Work Verification}
    end

    subgraph FactionContext["âš”ï¸ Faction Context"]
        WV --> |"Union work"| UW[Union Governance<br/>Attestation]
        WV --> |"Guild work"| GW[Guild Governance<br/>Attestation]
        WV --> |"Syndicate work"| SW[Syndicate Governance<br/>Attestation]
    end

    subgraph Minting["ğŸª™ PPT Minting (Cardano L1)"]
        UW --> |"Verified âœ“"| PDT_MINT["Mint PDT<br/>(Production Duty Token)"]
        GW --> |"Verified âœ“"| PCT_MINT["Mint PCT<br/>(Procurer Consumption Token)"]
        SW --> |"Verified âœ“"| PMT_MINT["Mint PMT<br/>(Promoter Merit Token)"]
    end

    subgraph TITVault["ğŸ’° TIT Vault (Single UTxO, Multi-Asset)"]
        PDT_MINT --> PDT_BAL["PDT Balance"]
        PCT_MINT --> PCT_BAL["PCT Balance"]
        PMT_MINT --> PMT_BAL["PMT Balance"]
        
        PDT_BAL & PCT_BAL & PMT_BAL --> TOTAL["Total PPT<br/>(aggregate)"]
    end

    subgraph Transmutation["ğŸ”® Steward Transmutation Decision"]
        TOTAL --> |"Steward initiates<br/>(per sub-type)"| TX_CHOICE{Transmutation<br/>Path Selection}
        
        TX_CHOICE --> |"Path A"| GOV["ğŸ›ï¸ Governance Influence<br/>â†’ SEID Vault governance weight<br/>â†’ Voting power in faction/node"]
        TX_CHOICE --> |"Path B"| COMM["ğŸ’ COMM Wealth<br/>â†’ SEID Vault COMM balance<br/>â†’ Wealth accumulation"]
        TX_CHOICE --> |"Path C (mixed)"| MIXED["ğŸ“Š Mixed Path<br/>e.g., PDT â†’ Governance<br/>PCT â†’ Wealth<br/>PMT â†’ Governance"]
    end

    subgraph SEIDVault["ğŸ‘¤ SEID Vault (Steward Root)"]
        GOV --> SEID_GOV["Governance Weight"]
        COMM --> SEID_COMM["COMM Token Balance"]
        MIXED --> SEID_GOV
        MIXED --> SEID_COMM
    end

    subgraph VELOC["ğŸ¦ VELOC Credit Line"]
        TOTAL -.-> |"@T entity as<br/>RWA collateral"| ORACLE["Valuation Oracle<br/>(CoCoA computed)"]
        ORACLE --> |"LTV ratio applied"| CREDIT["JLZ Credit Line<br/>â†’ SEID Vault"]
        CREDIT -.-> |"Interest accrues<br/>(daily, simple)"| REPAY["Repayment<br/>(from earnings or<br/>manual JLZ payment)"]
        REPAY -.-> |"Default"| REDIRECT["Earnings Redirect<br/>PPT â†’ Debt Service"]
        REDIRECT -.-> |"Continued default"| FORCED["Forced Transmutation<br/>or Stewardship Transfer"]
    end

    subgraph L2["âš¡ Hydra L2 (Optional Optimization)"]
        direction LR
        UH["Union Hydra Head"] -.-> PDT_MINT
        GH["Guild Hydra Head"] -.-> PCT_MINT
        SH["Syndicate Hydra Head"] -.-> PMT_MINT
        
        UH & GH & SH -.-> |"Head close â†’ L1 settle"| TITVault
    end

    style C3DEX fill:#e8f4fd,stroke:#2196f3
    style FactionContext fill:#fff3e0,stroke:#ff9800
    style Minting fill:#e8f5e9,stroke:#4caf50
    style TITVault fill:#fce4ec,stroke:#e91e63
    style Transmutation fill:#f3e5f5,stroke:#9c27b0
    style SEIDVault fill:#e0f2f1,stroke:#009688
    style VELOC fill:#fff8e1,stroke:#ffc107
    style L2 fill:#f5f5f5,stroke:#9e9e9e,stroke-dasharray: 5 5
