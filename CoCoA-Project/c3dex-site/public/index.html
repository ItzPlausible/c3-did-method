<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C3DEX - Decentralized Coordination Marketplace</title>
  <meta name="description" content="C3DEX enables sovereign communities to coordinate Quests, execute Missions, and exchange Impact Offers ‚Äî powered by blockchain-verified credentials and AI-facilitated matching.">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-slow {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-slow { animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    .bg-gray-750 { background-color: rgb(38, 42, 51); }
  </style>
</head>
<body class="min-h-screen bg-gray-950 text-gray-100">
  
  <!-- Navigation -->
  <nav class="border-b border-gray-800 bg-gray-950/90 backdrop-blur-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-700 via-purple-700 to-blue-800 flex items-center justify-center">
          <span class="text-yellow-400 font-bold text-lg">C¬≥</span>
        </div>
        <span class="text-xl font-bold">C3DEX</span>
      </div>
      <div class="flex items-center gap-6">
        <a href="#coordination" class="text-gray-400 hover:text-white transition-colors hidden md:block">Coordination</a>
        <a href="#architecture" class="text-gray-400 hover:text-white transition-colors hidden md:block">Architecture</a>
        <a href="#roadmap" class="text-gray-400 hover:text-white transition-colors hidden md:block">Roadmap</a>
        
        <!-- Wallet Button -->
        <div class="relative" id="walletContainer">
          <button 
            id="walletBtn"
            onclick="handleWalletClick()"
            class="px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 font-semibold rounded-lg hover:from-yellow-400 hover:to-yellow-500 transition-all flex items-center gap-2"
          >
            <span id="walletBtnText">Connect Wallet</span>
          </button>
          
          <!-- Dropdown (hidden by default) -->
          <div id="walletDropdown" class="absolute right-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-lg shadow-xl hidden">
            <a 
              href="https://cocoa-mvp.team-d90.workers.dev" 
              target="_blank" 
              rel="noopener noreferrer"
              class="block px-4 py-3 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors rounded-t-lg"
            >
              ü§ñ Open CoCoA
            </a>
            <button 
              onclick="disconnectWallet()"
              class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-gray-700 transition-colors rounded-b-lg"
            >
              Disconnect
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Error Toast -->
    <div id="walletError" class="hidden absolute top-full left-1/2 -translate-x-1/2 mt-2 px-4 py-2 bg-red-900/90 border border-red-700 rounded-lg text-sm text-red-200 flex items-center gap-2">
      <span>‚ö†Ô∏è</span>
      <span id="walletErrorText"></span>
      <button onclick="hideError()" class="ml-2 text-red-400 hover:text-red-200">‚úï</button>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-red-900/20 via-purple-900/20 to-blue-900/20"></div>
    <div class="absolute inset-0">
      <div class="absolute top-20 left-1/4 w-96 h-96 bg-purple-600/10 rounded-full blur-3xl"></div>
      <div class="absolute bottom-20 right-1/4 w-96 h-96 bg-blue-600/10 rounded-full blur-3xl"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-6 py-24 text-center">
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-gray-800/50 rounded-full border border-gray-700 mb-8">
        <span class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></span>
        <span class="text-sm text-gray-300">C3 Alliance Infrastructure</span>
      </div>
      
      <h1 class="text-5xl md:text-7xl font-bold mb-6">
        <span class="bg-gradient-to-r from-red-500 via-purple-500 to-blue-500 bg-clip-text text-transparent">
          Decentralized
        </span>
        <br>
        <span class="text-white">Coordination Marketplace</span>
      </h1>
      
      <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-12">
        C3DEX enables sovereign communities to coordinate Quests, execute Missions, and exchange Impact Offers ‚Äî 
        powered by blockchain-verified credentials and AI-facilitated matching.
      </p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <button class="px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl font-semibold hover:from-purple-500 hover:to-blue-500 transition-all shadow-lg shadow-purple-900/30">
          View Whitepaper
        </button>
        <a 
          href="https://cocoa-mvp.team-d90.workers.dev" 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-8 py-4 bg-gray-800 border border-gray-700 rounded-xl font-semibold hover:bg-gray-750 transition-all flex items-center justify-center gap-2"
        >
          ü§ñ Try CoCoA
        </a>
      </div>
    </div>
  </section>

  <!-- Coordination Hierarchy Section -->
  <section id="coordination" class="py-24 bg-gray-900/50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold mb-4">Coordination Hierarchy</h2>
        <p class="text-gray-400 text-lg max-w-2xl mx-auto">
          A three-tier framework for organizing collective action from strategic vision to operational execution
        </p>
      </div>

      <!-- Tab Buttons -->
      <div class="flex justify-center items-center gap-2 md:gap-4 mb-12 flex-wrap">
        <button onclick="setActiveTab('quest')" id="tab-quest" class="px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gradient-to-r from-purple-600 to-purple-800 shadow-lg">
          Quest
        </button>
        <svg class="w-6 h-6 text-yellow-500 hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
        <button onclick="setActiveTab('mission')" id="tab-mission" class="px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gray-800 hover:bg-gray-750">
          Mission
        </button>
        <svg class="w-6 h-6 text-yellow-500 hidden md:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
        </svg>
        <button onclick="setActiveTab('impact')" id="tab-impact" class="px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gray-800 hover:bg-gray-750">
          Impact Offer
        </button>
      </div>

      <!-- Tab Content -->
      <div id="tab-content-quest" class="tab-content bg-gradient-to-br from-purple-600 to-purple-800 rounded-2xl p-8 md:p-12">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <div class="text-sm font-semibold text-gray-300 mb-2">Strategic Objectives</div>
            <h3 class="text-3xl font-bold mb-4">Quest</h3>
            <p class="text-gray-200 leading-relaxed">High-level coordination goals that define what the Alliance aims to achieve. Quests represent the "why" ‚Äî the strategic direction that mobilizes collective action.</p>
          </div>
          <div class="bg-black/20 rounded-xl p-6">
            <div class="text-sm font-semibold text-gray-400 mb-4">Examples</div>
            <ul class="space-y-3">
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Launch Regional Food Sovereignty Network</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Establish 10 Community Land Trusts</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Deploy Renewable Energy Microgrid</li>
            </ul>
          </div>
        </div>
      </div>

      <div id="tab-content-mission" class="tab-content hidden bg-gradient-to-br from-blue-700 to-blue-900 rounded-2xl p-8 md:p-12">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <div class="text-sm font-semibold text-gray-300 mb-2">Tactical Coordination</div>
            <h3 class="text-3xl font-bold mb-4">Mission</h3>
            <p class="text-gray-200 leading-relaxed">Discrete, measurable campaigns that advance Quest objectives. Missions break down strategic goals into coordinated efforts with clear deliverables and timelines.</p>
          </div>
          <div class="bg-black/20 rounded-xl p-6">
            <div class="text-sm font-semibold text-gray-400 mb-4">Examples</div>
            <ul class="space-y-3">
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Onboard 50 Pioneer Members</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Complete Phase 1 Infrastructure Buildout</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Integrate Payment Rails</li>
            </ul>
          </div>
        </div>
      </div>

      <div id="tab-content-impact" class="tab-content hidden bg-gradient-to-br from-red-700 to-red-900 rounded-2xl p-8 md:p-12">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <div class="text-sm font-semibold text-gray-300 mb-2">Operational Exchange</div>
            <h3 class="text-3xl font-bold mb-4">Impact Offer</h3>
            <p class="text-gray-200 leading-relaxed">The atomic unit of value exchange. Impact Offers are specific contributions ‚Äî skills, resources, capital, or labor ‚Äî matched to Mission requirements through the marketplace.</p>
          </div>
          <div class="bg-black/20 rounded-xl p-6">
            <div class="text-sm font-semibold text-gray-400 mb-4">Examples</div>
            <ul class="space-y-3">
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Smart Contract Development (40 hrs)</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Legal Document Review</li>
              <li class="flex items-center gap-3 text-gray-200"><span class="w-2 h-2 bg-yellow-400 rounded-full"></span>Equipment Lease: Solar Panels</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Flow Visualization -->
      <div class="mt-16 bg-gray-800/50 rounded-2xl p-8 border border-gray-700">
        <h3 class="text-xl font-bold mb-8 text-center">Impact Flow Cycle</h3>
        <div class="flex flex-col md:flex-row items-center justify-between gap-4 md:gap-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-purple-600/20 rounded-xl flex items-center justify-center mx-auto mb-3">
              <span class="text-2xl">üéØ</span>
            </div>
            <div class="font-semibold">Quest Defined</div>
            <div class="text-sm text-gray-500">Alliance governance</div>
          </div>
          <svg class="w-8 h-8 text-gray-600 rotate-90 md:rotate-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
          <div class="text-center">
            <div class="w-16 h-16 bg-blue-600/20 rounded-xl flex items-center justify-center mx-auto mb-3">
              <span class="text-2xl">üìã</span>
            </div>
            <div class="font-semibold">Missions Created</div>
            <div class="text-sm text-gray-500">Tactical breakdown</div>
          </div>
          <svg class="w-8 h-8 text-gray-600 rotate-90 md:rotate-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
          <div class="text-center">
            <div class="w-16 h-16 bg-red-600/20 rounded-xl flex items-center justify-center mx-auto mb-3">
              <span class="text-2xl">ü§ù</span>
            </div>
            <div class="font-semibold">Offers Matched</div>
            <div class="text-sm text-gray-500">CoCoA facilitates</div>
          </div>
          <svg class="w-8 h-8 text-gray-600 rotate-90 md:rotate-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
          <div class="text-center">
            <div class="w-16 h-16 bg-yellow-600/20 rounded-xl flex items-center justify-center mx-auto mb-3">
              <span class="text-2xl">‚úÖ</span>
            </div>
            <div class="font-semibold">XPT Earned</div>
            <div class="text-sm text-gray-500">Credentials issued</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Technical Architecture Section -->
  <section id="architecture" class="py-24">
    <div class="max-w-7xl mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold mb-4">Technical Architecture</h2>
        <p class="text-gray-400 text-lg max-w-2xl mx-auto">
          Built on Cardano with native integrations for secure, verifiable coordination
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 mb-16">
        <!-- Lace Wallet -->
        <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 hover:border-gray-600 transition-all">
          <div class="flex justify-between items-start mb-4">
            <div class="text-4xl">üîê</div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-500/20 text-green-400">Live</span>
          </div>
          <h3 class="text-xl font-semibold mb-2">Lace Wallet</h3>
          <p class="text-gray-400">Native Cardano wallet integration for seamless ADA and native token transactions</p>
        </div>
        
        <!-- Oracle Services -->
        <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 hover:border-gray-600 transition-all">
          <div class="flex justify-between items-start mb-4">
            <div class="text-4xl">üì°</div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-700 text-gray-400">Coming Soon</span>
          </div>
          <h3 class="text-xl font-semibold mb-2">Oracle Services</h3>
          <p class="text-gray-400">Real-time pricing feeds and external data verification for transparent marketplace operations</p>
        </div>
        
        <!-- XPT Credentials -->
        <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 hover:border-gray-600 transition-all">
          <div class="flex justify-between items-start mb-4">
            <div class="text-4xl">üèÖ</div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-700 text-gray-400">Coming Soon</span>
          </div>
          <h3 class="text-xl font-semibold mb-2">XPT Credentials</h3>
          <p class="text-gray-400">Experience Proof Tokens validate member contributions and unlock governance participation</p>
        </div>
        
        <!-- CoCoA Agent -->
        <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 hover:border-gray-600 transition-all">
          <div class="flex justify-between items-start mb-4">
            <div class="text-4xl">ü§ñ</div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-500/20 text-green-400">Live</span>
          </div>
          <h3 class="text-xl font-semibold mb-2">CoCoA Agent Layer</h3>
          <p class="text-gray-400">AI-powered coordination assistant serving as the primary UI/UX interface</p>
        </div>
      </div>

      <!-- Tokenomics -->
      <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-8 border border-gray-700">
        <h3 class="text-2xl font-bold mb-6 text-center">Token Architecture</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div class="bg-black/30 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-yellow-400 mb-1">PPT</div>
            <div class="text-sm text-gray-300 font-medium mb-2">Patronage Performance Token</div>
            <div class="text-xs text-gray-500">Governance weight based on contribution history</div>
          </div>
          <div class="bg-black/30 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-yellow-400 mb-1">COMM</div>
            <div class="text-sm text-gray-300 font-medium mb-2">Community Membership</div>
            <div class="text-xs text-gray-500">Membership status and voting rights</div>
          </div>
          <div class="bg-black/30 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-yellow-400 mb-1">JLZ</div>
            <div class="text-sm text-gray-300 font-medium mb-2">Joules</div>
            <div class="text-xs text-gray-500">Energy-backed stablecoin for marketplace transactions</div>
          </div>
          <div class="bg-black/30 rounded-xl p-4 text-center">
            <div class="text-2xl font-bold text-yellow-400 mb-1">XPT</div>
            <div class="text-sm text-gray-300 font-medium mb-2">Experience Proof Token</div>
            <div class="text-xs text-gray-500">Credential verification and reputation</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Roadmap Section -->
  <section id="roadmap" class="py-24 bg-gray-900/50">
    <div class="max-w-7xl mx-auto px-6">
      <div class="text-center mb-16">
        <h2 class="text-4xl font-bold mb-4">Development Roadmap</h2>
        <p class="text-gray-400 text-lg">Building Sovereign Stewardship as a Service</p>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        <!-- Phase 1 -->
        <div class="rounded-2xl p-6 border bg-gradient-to-br from-purple-900/50 to-blue-900/50 border-purple-500/50">
          <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-500 text-gray-900">Phase 1</span>
            <span class="text-green-400 text-sm">‚úì Complete</span>
          </div>
          <h3 class="text-xl font-semibold mb-4">Foundation</h3>
          <ul class="space-y-2">
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>MVP Marketplace Framework</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>Quest/Mission/Impact Offer Architecture</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>Investor Documentation</li>
          </ul>
        </div>
        
        <!-- Phase 2 -->
        <div class="rounded-2xl p-6 border bg-gradient-to-br from-purple-900/50 to-blue-900/50 border-purple-500/50">
          <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-500 text-gray-900">Phase 2</span>
            <span class="text-yellow-400 text-sm">‚Üê Current</span>
          </div>
          <h3 class="text-xl font-semibold mb-4">Integration</h3>
          <ul class="space-y-2">
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>Lace Wallet Connection</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-green-400"></span>CoCoA Agent UI Layer</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-yellow-400"></span>Basic Oracle Integration</li>
          </ul>
        </div>
        
        <!-- Phase 3 -->
        <div class="rounded-2xl p-6 border bg-gray-800/50 border-gray-700">
          <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-600 text-gray-300">Phase 3</span>
          </div>
          <h3 class="text-xl font-semibold mb-4">Expansion</h3>
          <ul class="space-y-2">
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-gray-600"></span>Full Tokenomics Deployment</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-gray-600"></span>Cross-chain Bridges</li>
            <li class="flex items-center gap-2 text-gray-300"><span class="w-1.5 h-1.5 rounded-full bg-gray-600"></span>DAO Governance Launch</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-24">
    <div class="max-w-4xl mx-auto px-6 text-center">
      <div class="bg-gradient-to-br from-red-900/30 via-purple-900/30 to-blue-900/30 rounded-3xl p-12 border border-gray-700">
        <h2 class="text-4xl font-bold mb-4">Join the Alliance</h2>
        <p class="text-gray-400 text-lg mb-8 max-w-2xl mx-auto">
          We're building infrastructure for sovereign communities to coordinate at scale. 
          Interested in pioneering the future of cooperative economics?
        </p>
        <div class="flex flex-col sm:flex-row justify-center gap-4">
          <button class="px-8 py-4 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 rounded-xl font-semibold hover:from-yellow-400 hover:to-yellow-500 transition-all shadow-lg">
            Pioneer Program Inquiry
          </button>
          <button class="px-8 py-4 bg-gray-800 border border-gray-600 rounded-xl font-semibold hover:bg-gray-750 transition-all">
            Investment Deck
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-gray-800 py-12">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex flex-col md:flex-row justify-between items-center gap-6">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-red-700 via-purple-700 to-blue-800 flex items-center justify-center">
            <span class="text-yellow-400 font-bold text-lg">C¬≥</span>
          </div>
          <div>
            <div class="font-bold">C3DEX</div>
            <div class="text-sm text-gray-500">A C3 Alliance Protocol</div>
          </div>
        </div>
        <div class="text-sm text-gray-500">
          Powered by <span class="text-yellow-500 font-semibold">Plausible Potentials</span> ‚Ä¢ Built on Cardano
        </div>
      </div>
    </div>
  </footer>

  <script>
    // State
    let walletConnected = false;
    let walletAddress = '';

    // DOM Elements
    const walletBtn = document.getElementById('walletBtn');
    const walletBtnText = document.getElementById('walletBtnText');
    const walletDropdown = document.getElementById('walletDropdown');
    const walletError = document.getElementById('walletError');
    const walletErrorText = document.getElementById('walletErrorText');

    // Check existing connection on load
    document.addEventListener('DOMContentLoaded', async () => {
      if (window.cardano?.lace) {
        try {
          const isEnabled = await window.cardano.lace.isEnabled();
          if (isEnabled) {
            const api = await window.cardano.lace.enable();
            const addresses = await api.getUsedAddresses();
            if (addresses && addresses.length > 0) {
              walletAddress = addresses[0];
              walletConnected = true;
              updateWalletUI();
            }
          }
        } catch (e) {
          console.log('No existing wallet connection');
        }
      }
    });

    // Toggle dropdown on hover for connected state
    document.getElementById('walletContainer').addEventListener('mouseenter', () => {
      if (walletConnected) walletDropdown.classList.remove('hidden');
    });
    document.getElementById('walletContainer').addEventListener('mouseleave', () => {
      walletDropdown.classList.add('hidden');
    });

    // Wallet click handler
    async function handleWalletClick() {
      if (walletConnected) return; // Dropdown handles actions
      await connectWallet();
    }

    // Connect wallet
    async function connectWallet() {
      hideError();
      walletBtnText.innerHTML = '<svg class="animate-spin h-4 w-4 inline mr-2" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>Connecting...';

      try {
        if (!window.cardano || !window.cardano.lace) {
          showError('Lace wallet not found. Please install from lace.io');
          window.open('https://www.lace.io/', '_blank');
          walletBtnText.textContent = 'Connect Wallet';
          return;
        }

        const api = await window.cardano.lace.enable();
        const addresses = await api.getUsedAddresses();
        
        if (!addresses || addresses.length === 0) {
          const unusedAddresses = await api.getUnusedAddresses();
          if (unusedAddresses && unusedAddresses.length > 0) {
            walletAddress = unusedAddresses[0];
          } else {
            throw new Error('No addresses found in wallet');
          }
        } else {
          walletAddress = addresses[0];
        }

        walletConnected = true;
        updateWalletUI();

      } catch (error) {
        console.error('Wallet connection error:', error);
        showError(error.message || 'Failed to connect wallet');
        walletBtnText.textContent = 'Connect Wallet';
      }
    }

    // Disconnect wallet
    function disconnectWallet() {
      walletConnected = false;
      walletAddress = '';
      walletDropdown.classList.add('hidden');
      updateWalletUI();
    }

    // Update UI based on wallet state
    function updateWalletUI() {
      if (walletConnected) {
        walletBtn.className = 'px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-lg flex items-center gap-2';
        walletBtnText.innerHTML = '<span class="w-2 h-2 bg-white rounded-full animate-pulse"></span>' + formatAddress(walletAddress);
      } else {
        walletBtn.className = 'px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900 font-semibold rounded-lg hover:from-yellow-400 hover:to-yellow-500 transition-all flex items-center gap-2';
        walletBtnText.textContent = 'Connect Wallet';
      }
    }

    // Format address for display
    function formatAddress(addr) {
      if (!addr || addr.length < 20) return addr;
      return addr.substring(0, 8) + '...' + addr.slice(-6);
    }

    // Show error
    function showError(message) {
      walletErrorText.textContent = message;
      walletError.classList.remove('hidden');
      setTimeout(hideError, 5000);
    }

    // Hide error
    function hideError() {
      walletError.classList.add('hidden');
    }

    // Tab switching
    function setActiveTab(tab) {
      // Hide all content
      document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
      
      // Reset all tab buttons
      document.getElementById('tab-quest').className = 'px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gray-800 hover:bg-gray-750';
      document.getElementById('tab-mission').className = 'px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gray-800 hover:bg-gray-750';
      document.getElementById('tab-impact').className = 'px-4 md:px-6 py-3 rounded-xl font-semibold transition-all bg-gray-800 hover:bg-gray-750';
      
      // Show selected content and highlight button
      document.getElementById('tab-content-' + tab).classList.remove('hidden');
      
      const colors = {
        quest: 'bg-gradient-to-r from-purple-600 to-purple-800 shadow-lg',
        mission: 'bg-gradient-to-r from-blue-700 to-blue-900 shadow-lg',
        impact: 'bg-gradient-to-r from-red-700 to-red-900 shadow-lg'
      };
      document.getElementById('tab-' + tab).className = 'px-4 md:px-6 py-3 rounded-xl font-semibold transition-all ' + colors[tab];
    }
  </script>
</body>
</html>
