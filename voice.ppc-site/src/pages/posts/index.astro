---
import PageLayout from '@/layouts/PageLayout.astro';
import PostCard from '@/components/PostCard.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const categories = [
  { label: 'All', value: '' },
  { label: 'C3 Alliance', value: 'c3-alliance' },
  { label: 'Cyber-Mutualism', value: 'cyber-mutualism' },
  { label: 'Cooperative Economics', value: 'cooperative-economics' },
  { label: 'Blockchain Governance', value: 'blockchain-governance' },
  { label: 'Sovereignty', value: 'sovereignty' },
  { label: 'Technical', value: 'technical' },
  { label: 'Announcements', value: 'announcements' },
];
---

<PageLayout title="Posts" description="All posts from Voice">
  <section class="posts-page">
    <div class="posts-page__container container">
      <header class="posts-page__header">
        <h1 class="posts-page__title">Posts</h1>
        <p class="posts-page__description">
          Sovereignty-first insights on cooperative economics, blockchain governance, and cyber-mutualism.
        </p>
      </header>
      
      <nav class="posts-page__filters">
        {categories.map((cat) => (
          <a 
            href={cat.value ? `/posts/category/${cat.value}` : '/posts'}
            class:list={['posts-page__filter', { 'posts-page__filter--active': !cat.value }]}
          >
            {cat.label}
          </a>
        ))}
      </nav>
      
      <div class="posts-page__grid">
        {posts.map((post, index) => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            heroImage={post.data.heroImage}
            slug={post.slug}
            category={post.data.category}
            featured={index === 0}
          />
        ))}
      </div>
      
      {posts.length === 0 && (
        <div class="posts-page__empty">
          <p>No posts yet. Check back soon!</p>
        </div>
      )}
    </div>
  </section>
</PageLayout>

<style>
  .posts-page {
    padding: var(--space-16) 0 var(--space-24);
  }
  
  .posts-page__header {
    margin-bottom: var(--space-10);
  }
  
  .posts-page__title {
    font-size: var(--text-4xl);
    margin-bottom: var(--space-4);
  }
  
  .posts-page__description {
    font-size: var(--text-lg);
    color: var(--color-text-muted);
    max-width: 60ch;
  }
  
  .posts-page__filters {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-10);
    padding-bottom: var(--space-6);
    border-bottom: 1px solid var(--color-border);
  }
  
  .posts-page__filter {
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-text-muted);
    text-decoration: none;
    padding: var(--space-2) var(--space-4);
    border-radius: var(--radius-full);
    transition: 
      background-color var(--transition-fast),
      color var(--transition-fast);
  }
  
  .posts-page__filter:hover {
    background: var(--gray-100);
    color: var(--color-text);
  }
  
  @media (prefers-color-scheme: dark) {
    .posts-page__filter:hover {
      background: var(--gray-700);
    }
  }
  
  .posts-page__filter--active {
    background: var(--crimson);
    color: var(--white);
  }
  
  .posts-page__filter--active:hover {
    background: var(--crimson-dark);
    color: var(--white);
  }
  
  .posts-page__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
  }
  
  @media (max-width: 768px) {
    .posts-page__grid {
      grid-template-columns: 1fr;
    }
  }
  
  .posts-page__empty {
    text-align: center;
    padding: var(--space-16);
    color: var(--color-text-muted);
  }
</style>
